<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ai-Aè‚¡äº¤æ˜“æœºå™¨ A-share AI</title>
    <script src="config.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/socket.io/4.0.0/socket.io.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
            transform: scale(0.8);  
            transform-origin: top left;
            width: 125%;
            height: 125%;
            overflow-x: hidden;
        }
        .container {
            max-width: 100%;
            margin: 0 auto;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-shrink: 0;
        }
        .header h1 {
            text-align: left;
            margin: 0;
            font-size: 26px;
        }
        .header-nav {
            display: flex;
            gap: 24px;
            justify-content: center;
            flex: 1;
        }
        .header-nav a {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
            font-size: 20px;
        }
        .header-nav a:hover {
            color: #764ba2;
        }
        .content-wrapper {
            display: flex;
            gap: 20px;
            flex: 1;
            min-height: 0;
        }
        .left-column {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
            min-height: 0;
        }
        .right-column {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }
        .chart-wrapper, .logs-container, .readme-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .chart-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 0;
        }
        .chart-wrapper h2 {
            margin-top: 0;
            flex-shrink: 0;
        }
        #performanceChart {
            width: 100%;
            height: 100%;
            max-height: none;
        }
        .lazy-load-container {
            flex: 1;
            position: relative;
            min-height: 0;
        }
        .logs-container {
            display: flex;
            flex-direction: column;
            flex: 1;
            min-height: 0;
        }
        .logs-container h2 {
            margin-top: 0;
            flex-shrink: 0;
            text-align: left;
        }
        #logContainer {
            flex: 1;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            font-family: monospace;
            font-size: 14px;
            text-align: left;
            min-height: 0;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
            text-align: left;
        }
        .log-entry .timestamp {
            color: #666;
            margin-right: 10px;
        }
        .log-entry .level {
            display: inline-block;
            width: 70px;
            text-align: center;
            margin-right: 10px;
            padding: 2px 5px;
            border-radius: 3px;
            font-size: 12px;
        }
        .level.INFO { background-color: #d1ecf1; color: #0c5460; }
        .level.WARNING { background-color: #fff3cd; color: #856404; }
        .level.ERROR { background-color: #f8d7da; color: #721c24; }
        
        .readme-container {
            flex: 1;
            overflow-y: auto;
            min-height: 0;
        }
        .readme-container h1 {
            font-size: 1.8em;
            color: #333;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        .readme-container h2 {
            font-size: 1.4em;
            color: #444;
            margin-top: 25px;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
        }
        .readme-container h3 {
            font-size: 1.2em;
            color: #555;
            margin-top: 20px;
        }
        .readme-container ul {
            padding-left: 20px;
        }
        .readme-container li {
            margin-bottom: 10px;
            line-height: 1.5;
        }
        .readme-container p {
            line-height: 1.6;
            color: #666;
            margin: 10px 0;
        }
        .readme-container code {
            background-color: #f8f8f8;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: monospace;
        }
        .readme-container blockquote {
            border-left: 4px solid #ddd;
            margin: 0;
            padding: 0 15px;
            color: #777;
        }
        .readme-container .email {
            font-weight: bold;
            color: #0066cc;
        }
        
        .lazy-load-container {
            position: relative;
            min-height: 200px;
        }
        
        .lazy-load-placeholder {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #666;
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Ai-Aè‚¡äº¤æ˜“æœºå™¨â€”â€”æ¥å…¥çœŸå®è´¦æˆ·ï¼Œå®ç°ç§’çº§äº¤æ˜“ï¼›100% Aiè‡ªä¸»å†³ç­–ï¼ŒAiè‡ªæˆ‘å‘ç°ã€è‡ªæˆ‘è®­ç»ƒã€è‡ªæˆ‘è¿›åŒ–</h1>
            <div class="header-nav">
                <a href="index.html">å®æ—¶æ”¶ç›ŠåŠå†³ç­–æ—¥å¿—</a>
                <a href="portfolio.html">AiæŠ•èµ„ç»„åˆï¼ˆç‚¹å‡»è·³è½¬ï¼‰</a>
            </div>
        </div>
        
        <div class="content-wrapper">
            <div class="left-column">
                <div class="chart-wrapper">
                    <h2>æ¨¡å‹æ”¶ç›Šæ›²çº¿ï¼ˆå®æ—¶æ•°æ®ï¼‰
                        <button id="toggleDataButton" style="float: right; margin-top: -5px; font-size: 14px;">æ˜¾ç¤ºå…¨éƒ¨æ•°æ®</button>
                    </h2>
                    <div class="lazy-load-container" id="chartContainer">
                        <div class="lazy-load-placeholder" id="chartPlaceholder">
                            <div class="loading-spinner"></div>
                            <p>æ­£åœ¨åŠ è½½å›¾è¡¨...</p>
                        </div>
                        <canvas id="performanceChart" style="display: none; width: 100%; height: 100%;"></canvas>
                    </div>
                </div>
                
                <div class="readme-container">
                    <h1>å¹»é“¶é‡åŒ–Ai-Aè‚¡äº¤æ˜“æœºå™¨ A-share AI</h1>

                    <p>åŸºäºå››å¤§å›½å†…å¤§æ¨¡å‹ï¼ˆå¹»é“¶è¶…iã€DeepSeekã€é€šä¹‰åƒé—®ã€è±†åŒ…ï¼‰çš„Aè‚¡è‡ªåŠ¨äº¤æ˜“ç³»ç»Ÿï¼Œæ”¯æŒå…¨å¸‚åœºé€‰è‚¡å’Œå®ç›˜äº¤æ˜“ã€‚</p>

                    <h2>åŠŸèƒ½ç‰¹æ€§</h2>

                    <ul>
                        <li><strong>çœŸå®äº¤æ˜“è´¦æˆ·</strong>ï¼šæ¥å…¥Aè‚¡çœŸå®äº¤æ˜“è´¦æˆ·ï¼Œå¹¶éè±¡æŸtraderé‚£æ ·åªæ˜¯ä½¿ç”¨çœŸå®å¸‚åœºæ•°æ®æ¨¡æ‹Ÿæˆäº¤</li>
                        <li><strong>ç§’çº§å®ç›˜äº¤æ˜“</strong>ï¼šæ¥å…¥å®ç›˜ç§’çº§ç²¾åº¦äº¤æ˜“ï¼Œå®æ—¶å±•ç¤ºaiçœŸå®äº¤æ˜“è¿‡ç¨‹</li>
                        <li><strong>AIè‡ªä¸»å†³ç­–</strong>ï¼š100% AIè‡ªä¸»å†³ç­–ï¼Œé›¶äººå·¥å¹²é¢„ï¼Œaiç­–ç•¥è‡ªæˆ‘å‘ç°ã€è‡ªæˆ‘è®­ç»ƒã€è‡ªæˆ‘è¿›åŒ–</li>
                        <li><strong>å¯é€‰å®æ—¶å¹²é¢„</strong>ï¼šåœ¨äº¤æ˜“è¿‡ç¨‹ä¸­å¯æ·»åŠ å®æ—¶äººå·¥å¹²é¢„å’ŒAiè¿›è¡Œäº’åŠ¨ï¼ˆå¯é€‰ï¼‰ï¼Œé€‚åº”å¤§è§„æ¨¡æŠ•èµ„çš„çœŸå®åœºæ™¯</li>
                        <li><strong>4å¤§æ¨¡å‹å¹¶è¡Œ</strong>ï¼šå¹»é“¶è¶…iã€DeepSeekã€Qwené€šä¹‰åƒé—®ã€è±†åŒ…åŒæ—¶è¿è¡Œï¼Œæ¯”è¾ƒæ”¶ç›Š</li>
                        <li><strong>å…¨å¸‚åœºé€‰è‚¡</strong>ï¼šAIè‡ªä¸»ä»å…¨å¸‚åœºé€‰æ‹©æœ‰æ½œåŠ›çš„è‚¡ç¥¨</li>
                        <li><strong>å®æ—¶è¡Œæƒ…</strong>ï¼šé›†æˆå®æ—¶Aè‚¡æ•°æ®ï¼Œä¾›aiä½¿ç”¨å¹¶ç”¨äºå®é™…äº¤æ˜“</li>
                        <li><strong>å†å²è¡Œæƒ…+è´¢åŠ¡æ•°æ®</strong>ï¼šé›†æˆAè‚¡å†å²è¡Œæƒ…å’Œè´¢åŠ¡æ•°æ®ï¼Œä¾›aiåˆ†æå’Œè®­ç»ƒ</li>
                        <li><strong>æ™ºèƒ½äº¤æ˜“</strong>ï¼šåŸºäºAIåˆ†æç”Ÿæˆä¹°å–ä¿¡å·å¹¶å…¨è‡ªåŠ¨æ‰§è¡Œäº¤æ˜“</li>
                        <li><strong>å¤šç§ç­–ç•¥</strong>ï¼šåŒ…æ‹¬è¶‹åŠ¿è·Ÿè¸ªã€å‡çº¿ç­–ç•¥ã€æŠ€æœ¯æŒ‡æ ‡ç­–ç•¥ã€é‡åŒ–å¥—åˆ©ç­–ç•¥ç­‰ï¼Œå®Œå…¨ç”±aiè‡ªåŠ¨é€‰æ‹©å¹¶ä¸æ–­è¿›åŒ–</li>
                        <li><strong>å®æ—¶ç›‘æ§</strong>ï¼šUIç•Œé¢å®æ—¶æ˜¾ç¤ºæ”¶ç›Šæ›²çº¿å’Œäº¤æ˜“æ—¥å¿—</li>
                        <li><strong>é£é™©æ§åˆ¶</strong>ï¼šå†…ç½®ä»“ä½æ§åˆ¶å’Œæ­¢æŸæœºåˆ¶</li>
                    </ul>

                    <h2>å®‰è£…ä½¿ç”¨</h2>

                    <ol>
                        <li><strong>å®‰è£…</strong>
                        ç¨æ™šå°†æ‰“åŒ…æˆæ¡Œé¢exeè½¯ä»¶ï¼Œå¯ç›´æ¥ä¸‹è½½è¿è¡Œï¼Œæä¾›é•¿è¾¾3ä¸ªæœˆçš„å…è´¹è¯•ç”¨ï¼Œä½¿ç”¨è€…æä¾›åé¦ˆè¢«é‡‡çº³ï¼Œå°†å¯è·å–ä¸“ä¸šçš„æŠ€æœ¯æ”¯æŒå’Œé•¿æœŸä½¿ç”¨æƒã€‚é¢„çº¦é‚®ç®±ï¼š<span class="email">hyqi@tradey.dpdns.org</span>ï¼Œå‘é€æ‚¨çš„è”ç³»æ–¹å¼å’Œç®€çŸ­ä»‹ç»ï¼Œæˆ‘ä»¬å°†å°½å¿«å®‰æ’è¯•ç”¨ã€‚</li>
                    </ol>

                    <h2>æ ¸å¿ƒæ”¹è¿›</h2>

                    <p>æ ¸å¿ƒæ”¹è¿›ï¼šçœŸæ­£çš„AIè‡ªæˆ‘å‘ç°</p>
                    <ol>
                        <li>ä»ç©ºç™½æˆ–ä½¿ç”¨è€…è®¾å®šçš„é£æ ¼å¼€å§‹</li>
                    </ol>

                    <p>æ‰€æœ‰AIåˆå§‹å¯ä»¥éƒ½æ˜¯"è‡ªé€‚åº”æŠ•èµ„è€…"</p>

                    <p>ä¹Ÿå¯ä»¥é¢„è®¾æŠ•èµ„é£æ ¼</p>

                    <p>é€šè¿‡å®è·µå‘ç°è‡ªå·±çš„ç‰¹é•¿</p>

                    <h3>è‡ªæˆ‘åæ€æœºåˆ¶</h3>
                    <p>å®šæœŸå›é¡¾æŠ•èµ„è¡¨ç°</p>

                    <p>åˆ†æä»€ä¹ˆç­–ç•¥å¯¹è‡ªå·±æœ‰æ•ˆ</p>

                    <p>ä¸»åŠ¨è°ƒæ•´æŠ•èµ„å“²å­¦</p>

                    <h3>é£æ ¼è¿›åŒ–</h3>
                    <p>è®°å½•é£æ ¼å˜åŒ–è½¨è¿¹</p>

                    <p>åŸºäºè¡¨ç°è°ƒæ•´é£é™©åå¥½</p>

                    <p>é€æ­¥å½¢æˆç¨³å®šçš„æŠ•èµ„äººæ ¼</p>

                    <h3>çœŸæ­£çš„å·®å¼‚æ€§</h3>
                    <p>ç°åœ¨4ä¸ªAIå°†ï¼š</p>

                    <p>è‡ªä¸»å‘ç°é£æ ¼ï¼šDeepSeekå¯èƒ½å‘ç°è‡ªå·±æ“…é•¿é‡åŒ–ï¼ŒQwenå¯èƒ½åå¥½ä»·å€¼æŠ•èµ„</p>

                    <p>ä¸åŒçš„è¿›åŒ–è·¯å¾„ï¼šæ¯ä¸ªAIåŸºäºè‡ªèº«ç‰¹è´¨å’Œå¸‚åœºåé¦ˆå½¢æˆç‹¬ç‰¹é£æ ¼</p>

                    <p>åŠ¨æ€è°ƒæ•´ï¼šæ ¹æ®å¸‚åœºç¯å¢ƒå˜åŒ–è°ƒæ•´ç­–ç•¥</p>

                    <p>çœŸæ­£çš„ä¸ªæ€§ï¼šå‘å±•å‡ºåæ˜ å…¶"æ€§æ ¼"çš„æŠ•èµ„å“²å­¦</p>

                    <h3>é¢„æœŸç»“æœ</h3>
                    <p>æ‚¨å°†çœ‹åˆ°ï¼š</p>

                    <p>çœŸæ­£çš„AIä¸ªæ€§ï¼šæ¯ä¸ªAIå‘å±•å‡ºç‹¬ç‰¹çš„æŠ•èµ„èº«ä»½</p>

                    <p>åŠ¨æ€çš„é£æ ¼è¿›åŒ–ï¼šæŠ•èµ„é£æ ¼ä¼šéšç€ç»éªŒç§¯ç´¯è€Œæ”¹å˜</p>

                    <p>åŸºäºè¡¨ç°çš„è°ƒæ•´ï¼šæˆåŠŸçš„ç­–ç•¥è¢«ä¿ç•™ï¼Œå¤±è´¥çš„è¢«æ·˜æ±°</p>

                    <p>ä¸å¯é¢„æµ‹çš„ç»“æœï¼šæ— æ³•é¢„å…ˆçŸ¥é“å“ªä¸ªAIä¼šå‘å±•å‡ºä»€ä¹ˆé£æ ¼</p>

                    <p>è¿™æ ·è®¾è®¡åï¼Œæ‚¨å°†è§è¯çœŸæ­£çš„"AIæŠ•èµ„ç»ç†æˆé•¿å²"ï¼Œè€Œä¸æ˜¯é¢„å…ˆç¼–æ’çš„è¡¨æ¼”ã€‚æ¯ä¸ªAIéƒ½æœ‰æœºä¼šæ‰¾åˆ°æœ€é€‚åˆè‡ªå·±çš„æŠ•èµ„é“è·¯ï¼</p>

                    <blockquote>
                    <p>A decade ago, DeepMind revolutionized AI research. Their key insight was that choosing the right environment â€“ games â€“ would lead to rapid progress in frontier AI.</p>

                    <p>At HYQi, we believe financial markets are the best training environment for the next era of AI. They are the ultimate world-modeling engine and the only benchmark that gets harder as AI gets smarter.</p>

                    <p>Instead of games, we're using financial markets in a live trading environment to train new base models that create their own training data indefinitely. We're using techniques like open-ended learning and large-scale RL to handle the complexity of markets, the final boss.</p>

                    <p>If this resonates, we're hiring: engineers, researchers, founders, original thinkers.</p>

                    <p>If you're excited to build AlphaHYQi for the real world, get in touch.</p>

                    <p>"Capital allocation is the discipline through which intelligence converges with truth."</p>

                    <p>A shared vision for the future. â€” HYQi</p>

                    <p>åå¹´å‰ï¼ŒDeepMindå½»åº•æ”¹å˜äº†äººå·¥æ™ºèƒ½çš„ç ”ç©¶èŒƒå¼ã€‚ä»–ä»¬çš„æ ¸å¿ƒæ´è§åœ¨äºï¼šé€‰æ‹©æ­£ç¡®çš„è®­ç»ƒç¯å¢ƒâ€”â€”æ¸¸æˆâ€”â€”å°†æ¨åŠ¨å‰æ²¿äººå·¥æ™ºèƒ½çš„å¿«é€Ÿçªç ´ã€‚</p>

                    <p>åœ¨HYQiï¼Œæˆ‘ä»¬ç›¸ä¿¡é‡‘èå¸‚åœºæ˜¯ä¸‹ä¸€ä»£äººå·¥æ™ºèƒ½çš„æœ€ä½³è®­ç»ƒåœºã€‚å®ƒæ˜¯ä¸–ç•Œçº§åˆ«æ¨¡å‹å¼•æ“çš„ç»ˆæå½¢æ€ï¼Œä¹Ÿæ˜¯å”¯ä¸€ä¼šéšç€AIæ™ºèƒ½æå‡è€Œä¸æ–­å‡çº§éš¾åº¦çš„æ ‡æ†ã€‚</p>

                    <p>æˆ‘ä»¬æ­£ä»¥çœŸå®äº¤æ˜“ç¯å¢ƒçš„é‡‘èå¸‚åœºæ›¿ä»£æ¸¸æˆï¼Œè®­ç»ƒèƒ½å¤ŸæŒç»­è‡ªæˆ‘ç”Ÿæˆæ•°æ®çš„æ–°å‹åŸºç¡€æ¨¡å‹ã€‚é¢å¯¹å¸‚åœºè¿™ä¸ª"ç»ˆææŒ‘æˆ˜"ï¼Œæˆ‘ä»¬è¿ç”¨å¼€æ”¾å¼å­¦ä¹ ã€å¤§è§„æ¨¡å¼ºåŒ–å­¦ä¹ ç­‰æŠ€æœ¯æ¥é©¾é©­å…¶å¤æ‚æ€§ã€‚</p>

                    <p>å¿ƒæ€€æ­¤å¿µï¼Œæˆ‘ä»¬æ­£å¹¿çº³è´¤æ‰ï¼Œæ‹›å‹Ÿå·¥ç¨‹å¸ˆã€ç ”ç©¶å‘˜ã€åˆ›ä¸šä¼™ä¼´ä¸æ€ç»´ç ´å±€è€…ã€‚</p>

                    <p>å¦‚æœæ‚¨æ¸´æœ›ä¸ºç°å®ä¸–ç•Œæ‰“é€ Alpha-HYQiï¼Œæ¬¢è¿ä¸æˆ‘ä»¬æºæ‰‹ã€‚</p>

                    <p>"èµ„æœ¬é…ç½®ï¼Œæ˜¯æ™ºæ…§æ¥å—çœŸç†æ£€éªŒçš„è¯•é‡‘çŸ³"ã€‚</p>

                    <p>â€”â€”â€”å¹»é“¶è¶…iä¸æ‚¨å…±å‹‰</p>
                    </blockquote>
                </div>
            </div>
            
            <div class="right-column">
                <div class="logs-container">
                    <h2>è¿è¡Œæ—¥å¿—</h2>
                    <div id="logContainer"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ä»é…ç½®è·å– API åœ°å€
        // æ³¨æ„ï¼šTailscale Funnel URL æ ¼å¼é€šå¸¸æ˜¯ https://xxx.ts.netï¼ˆå·²åŒ…å«ç«¯å£æ˜ å°„ï¼‰
        const API_BASE = window.API_CONFIG ? window.API_CONFIG.baseUrl : 'http://localhost:4000';
        
        // Socket.IO æœåŠ¡å™¨åœ°å€
        // Tailscale Funnel é€šè¿‡ HTTPS æš´éœ² 4000 ç«¯å£ï¼ŒSocket.IO ä¼šè‡ªåŠ¨ä½¿ç”¨ WSSï¼ˆWebSocket Secureï¼‰
        let SOCKET_URL = API_BASE;
        if (!SOCKET_URL.startsWith('http')) {
            // å¦‚æœ URL æ²¡æœ‰åè®®ï¼Œæ·»åŠ  http://
            SOCKET_URL = `http://${SOCKET_URL}`;
        }
        
        // æ£€æŸ¥æ˜¯å¦æ˜¯ Tailscale Funnel URLï¼ˆ.ts.net åŸŸåï¼‰
        const isTailscaleFunnel = SOCKET_URL.includes('.ts.net');
        const isLocalhost = SOCKET_URL.includes('localhost') || SOCKET_URL.includes('127.0.0.1');
        
        console.log('ğŸ”§ API é…ç½®:', {
            API_BASE: API_BASE,
            SOCKET_URL: SOCKET_URL,
            isTailscaleFunnel: isTailscaleFunnel,
            isLocalhost: isLocalhost
        });
        
        // åˆå§‹åŒ–SocketIOè¿æ¥ï¼ˆå¦‚æœå¯ç”¨ï¼‰
        // Tailscale Funnel æ”¯æŒ WebSocketï¼Œå¯ä»¥å®ç°å®æ—¶æ¨é€
        let socket = null;
        let useSocketIO = false;
        
        try {
            // Socket.IO åº“å¯ç”¨ä¸”ä¸æ˜¯æœ¬åœ°åœ°å€æ—¶ï¼Œå°è¯•è¿æ¥
            if (typeof io !== 'undefined' && !isLocalhost) {
                console.log('ğŸš€ å°è¯•è¿æ¥ Socket.IO æœåŠ¡å™¨:', SOCKET_URL);
                
                socket = io(SOCKET_URL, {
                    reconnection: true,
                    reconnectionDelay: 1000,
                    reconnectionDelayMax: 5000,
                    reconnectionAttempts: 10, // Tailscale å¯èƒ½éœ€è¦æ›´å¤šé‡è¯•
                    transports: ['websocket', 'polling'], // ä¼˜å…ˆ WebSocketï¼Œå¤±è´¥æ—¶é™çº§åˆ° polling
                    timeout: 10000, // Tailscale å¯èƒ½éœ€è¦æ›´é•¿çš„è¶…æ—¶
                    autoConnect: true,
                    forceNew: false,
                    // å¯¹äº HTTPS/WSSï¼Œç¡®ä¿æ­£ç¡®å¤„ç†è¯ä¹¦
                    rejectUnauthorized: false // Tailscale ä½¿ç”¨è‡ªç­¾åè¯ä¹¦æ—¶éœ€è¦
                });
                
                // è¿æ¥æˆåŠŸ
                socket.on('connect', () => {
                    useSocketIO = true;
                    console.log('âœ… Socket.IO è¿æ¥æˆåŠŸï¼');
                    console.log('   - æœåŠ¡å™¨åœ°å€:', SOCKET_URL);
                    console.log('   - ä¼ è¾“æ–¹å¼:', socket.io.engine.transport.name);
                    console.log('   - ä½¿ç”¨å®æ—¶æ¨é€æ¨¡å¼');
                });
                
                // è¿æ¥å¤±è´¥
                socket.on('connect_error', (error) => {
                    useSocketIO = false;
                    console.warn('âš ï¸ Socket.IO è¿æ¥å¤±è´¥ï¼Œé™çº§åˆ° HTTP è½®è¯¢æ¨¡å¼');
                    console.warn('   é”™è¯¯ä¿¡æ¯:', error.message);
                    console.warn('   å°†ç»§ç»­ä½¿ç”¨ HTTP è½®è¯¢è·å–æ•°æ®');
                });
                
                // æ–­å¼€è¿æ¥
                socket.on('disconnect', (reason) => {
                    useSocketIO = false;
                    console.warn('âš ï¸ Socket.IO æ–­å¼€è¿æ¥:', reason);
                    console.warn('   å°†åˆ‡æ¢åˆ° HTTP è½®è¯¢æ¨¡å¼');
                });
                
                // æ¥æ”¶æœåŠ¡å™¨ç¡®è®¤
                socket.on('connection_success', (data) => {
                    console.log('âœ… æœåŠ¡å™¨ç¡®è®¤è¿æ¥:', data);
                });
                
                // æ¥æ”¶æ€§èƒ½æ•°æ®æ›´æ–°
                socket.on('performance_update', (data) => {
                    if (chart) {
                        updatePerformanceChart(chart, data);
                    }
                });
                
                // æ¥æ”¶æ—¥å¿—æ›´æ–°
                socket.on('new_log', (data) => {
                    const logContainer = document.getElementById('logContainer');
                    if (logContainer) {
                        addLogEntry(logContainer, data);
                    }
                });
            } else if (isLocalhost) {
                console.log('â„¹ï¸ æ£€æµ‹åˆ°æœ¬åœ°åœ°å€ï¼ŒSocket.IO å°†è¿æ¥åˆ°æœ¬åœ°æœåŠ¡å™¨');
                // æœ¬åœ°ç¯å¢ƒä¹Ÿå°è¯•è¿æ¥
                socket = io(SOCKET_URL, {
                    reconnection: true,
                    transports: ['websocket', 'polling']
                });
                socket.on('connect', () => {
                    useSocketIO = true;
                    console.log('âœ… æœ¬åœ° Socket.IO è¿æ¥æˆåŠŸ');
                });
                socket.on('connect_error', () => {
                    useSocketIO = false;
                    console.warn('âš ï¸ æœ¬åœ° Socket.IO è¿æ¥å¤±è´¥ï¼Œä½¿ç”¨ HTTP è½®è¯¢');
                });
            } else {
                console.log('â„¹ï¸ Socket.IO åº“æœªåŠ è½½ï¼Œä½¿ç”¨ HTTP è½®è¯¢æ¨¡å¼');
            }
        } catch (e) {
            console.warn('âš ï¸ Socket.IO åˆå§‹åŒ–å¤±è´¥ï¼Œä½¿ç”¨ HTTP è½®è¯¢æ¨¡å¼:', e.message);
        }
        
        // ç­‰å¾…Chart.jsåŠ è½½å®Œæˆåå†åˆå§‹åŒ–å›¾è¡¨
        function initChart() {
            if (typeof Chart === 'undefined') {
                console.log('Chart.jsæœªåŠ è½½å®Œæˆï¼Œç­‰å¾…ä¸­...');
                setTimeout(initChart, 1000);
                return;
            }
            
            console.log('Chart.jså·²åŠ è½½ï¼Œåˆå§‹åŒ–å›¾è¡¨');
            
            // åˆå§‹åŒ–å›¾è¡¨
            const ctx = document.getElementById('performanceChart').getContext('2d');
            const chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: []
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: 'æ—¶é—´',
                                font: {
                                    size: 12
                                }
                            }
                        },
                        y: {
                            display: true,
                            title: {
                                display: true,
                                text: 'ç´¯è®¡æ”¶ç›Šç‡ (%)',
                                font: {
                                    size: 12
                                }
                            },
                            ticks: {
                                precision: 2,
                                callback: function(value) {
                                    return value.toFixed(2) + '%';
                                }
                            },
                            beginAtZero: false,
                            grace: '10%'
                        }
                    },
                    animation: {
                        duration: 500
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'AIæ¨¡å‹æ”¶ç›Šç‡å¯¹æ¯”',
                            font: {
                                size: 14,
                                weight: 'bold'
                            }
                        },
                        legend: {
                            position: 'top',
                        }
                    },
                    elements: {
                        line: {
                            tension: 0.4,
                            borderWidth: 2
                        },
                        point: {
                            radius: 4,
                            hoverRadius: 6
                        }
                    }
                }
            });
            
            // æ˜¾ç¤ºå›¾è¡¨å¹¶éšè—åŠ è½½æç¤º
            document.getElementById('chartPlaceholder').style.display = 'none';
            document.getElementById('performanceChart').style.display = 'block';
            
            return chart;
        }
        
        // åˆå§‹åŒ–æ—¥å¿—å®¹å™¨
        function initLogContainer() {
            const logContainer = document.getElementById('logContainer');
            return logContainer;
        }
        
        // æ·»åŠ æ—¥å¿—æ¡ç›®
        function addLogEntry(logContainer, logEntry) {
            try {
                const logDiv = document.createElement('div');
                logDiv.className = 'log-entry';
                
                const timestamp = logEntry.timestamp || new Date().toISOString();
                const level = logEntry.level || 'INFO';
                const message = logEntry.message || '';
                
                logDiv.innerHTML = `
                    <span class="timestamp">${timestamp}</span>
                    <span class="level ${level}">${level}</span>
                    <span class="message">${message}</span>
                `;
                logContainer.appendChild(logDiv);
                logContainer.scrollTop = logContainer.scrollHeight;
                
                // é™åˆ¶æ—¥å¿—æ•°é‡
                if (logContainer.children.length > 500) {
                    logContainer.removeChild(logContainer.firstChild);
                }
            } catch (error) {
                console.error('Error adding log entry:', error);
            }
        }
        
        // æ›´æ–°æ€§èƒ½å›¾è¡¨
        function updatePerformanceChart(chart, data) {
            if (!chart || !data) return;
            
            // æ¸…ç©ºç°æœ‰æ•°æ®
            chart.data.labels = [];
            chart.data.datasets = [];
            
            // ä¸ºæ¯ä¸ªæ¨¡å‹åˆ›å»ºæ•°æ®é›†
            const colors = [
                'rgb(255, 99, 132)',
                'rgb(54, 162, 235)',
                'rgb(255, 205, 86)',
                'rgb(75, 192, 192)',
                'rgb(153, 102, 255)',
                'rgb(255, 159, 64)'
            ];
            
            let colorIndex = 0;
            let allTimes = [];
            
            // æ”¶é›†æ‰€æœ‰æ—¶é—´ç‚¹
            for (const [modelName, modelData] of Object.entries(data)) {
                if (modelData && Array.isArray(modelData)) {
                    modelData.forEach(point => {
                        if (point.time && !allTimes.includes(point.time)) {
                            allTimes.push(point.time);
                        }
                    });
                }
            }
            
            // æŒ‰æ—¶é—´æ’åº
            allTimes.sort();
            
            // æå–æ—¶é—´æ ‡ç­¾ï¼ˆåªæ˜¾ç¤ºæ—¶é—´éƒ¨åˆ†ï¼‰
            const timeLabels = allTimes.map(timeStr => {
                const date = new Date(timeStr);
                return date.toLocaleTimeString();
            });
            
            chart.data.labels = timeLabels;
            
            // ä¸ºæ¯ä¸ªæ¨¡å‹åˆ›å»ºæ•°æ®é›†
            for (const [modelName, modelData] of Object.entries(data)) {
                if (modelData && Array.isArray(modelData)) {
                    const color = colors[colorIndex % colors.length];
                    colorIndex++;
                    
                    // åˆ›å»ºä¸æ—¶é—´æ ‡ç­¾å¯¹é½çš„æ”¶ç›Šç‡æ•°æ®
                    const profits = [];
                    const timeMap = {};
                    
                    // å»ºç«‹æ—¶é—´åˆ°æ”¶ç›Šç‡çš„æ˜ å°„
                    modelData.forEach(point => {
                        timeMap[point.time] = point.profit;
                    });
                    
                    // æ ¹æ®æ—¶é—´æ ‡ç­¾å¡«å……æ”¶ç›Šç‡æ•°æ®
                    allTimes.forEach(timeStr => {
                        const profitValue = timeMap[timeStr];
                        if (profitValue !== undefined) {
                            const numValue = typeof profitValue === 'string' ? parseFloat(profitValue) : Number(profitValue);
                            profits.push(isNaN(numValue) ? null : numValue);
                        } else {
                            profits.push(null);
                        }
                    });
                    
                    const dataset = {
                        label: modelName,
                        data: profits,
                        borderColor: color,
                        backgroundColor: color.replace(')', ', 0.1)').replace('rgb', 'rgba'),
                        fill: false,
                        tension: 0.4,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    };
                    
                    chart.data.datasets.push(dataset);
                }
            }
            
            // å¼ºåˆ¶æ›´æ–°å›¾è¡¨
            chart.update('active');
        }
        
        // HTTPè½®è¯¢è·å–æ•°æ®ï¼ˆGitHub Pages çš„ä¸»è¦æ•°æ®è·å–æ–¹å¼ï¼‰
        function fetchPerformanceData() {
            // å¦‚æœ Socket.IO å¯ç”¨ï¼Œè·³è¿‡ HTTP è½®è¯¢ï¼ˆç”± Socket.IO æ¨é€ï¼‰
            if (useSocketIO && socket && socket.connected) {
                return;
            }
            
            const url = `${API_BASE}/api/performance`;
            fetch(url, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'Cache-Control': 'no-cache, no-store, must-revalidate',
                    'Pragma': 'no-cache',
                    'Expires': '0'
                },
                cache: 'no-store'
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (chart) {
                        updatePerformanceChart(chart, data);
                    }
                })
                .catch(error => {
                    console.error('âŒ è·å–æ€§èƒ½æ•°æ®å¤±è´¥:', error.message);
                });
        }
        
        // å¯åŠ¨åˆå§‹åŒ–è¿‡ç¨‹
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–å›¾è¡¨
            let chart = null;
            const chartInitInterval = setInterval(() => {
                const newChart = initChart();
                if (newChart) {
                    chart = newChart;
                    clearInterval(chartInitInterval);
                    console.log('å›¾è¡¨åˆå§‹åŒ–å®Œæˆ');
                    // åˆå§‹åŒ–åç«‹å³è·å–ä¸€æ¬¡æ•°æ®
                    fetchPerformanceData();
                    // å¼€å§‹å®šæ—¶è½®è¯¢ï¼ˆæ¯10ç§’ï¼‰
                    // æ³¨æ„ï¼šå¦‚æœ Socket.IO è¿æ¥æˆåŠŸï¼ŒHTTP è½®è¯¢ä¼šè¢«è·³è¿‡
                    setInterval(fetchPerformanceData, 10000);
                }
            }, 1000);
            
            // æ·»åŠ åˆ‡æ¢æ˜¾ç¤ºæ•°æ®çš„æŒ‰é’®äº‹ä»¶ç›‘å¬å™¨
            let showFullData = false;
            const toggleButton = document.getElementById('toggleDataButton');
            if (toggleButton) {
                toggleButton.addEventListener('click', function() {
                    showFullData = !showFullData;
                    toggleButton.textContent = showFullData ? 'æ˜¾ç¤ºæœ€è¿‘æ•°æ®' : 'æ˜¾ç¤ºå…¨éƒ¨æ•°æ®';
                    
                    const url = showFullData ? `${API_BASE}/api/performance_full` : `${API_BASE}/api/performance`;
                    fetch(url)
                        .then(response => response.json())
                        .then(data => {
                            if (chart) {
                                updatePerformanceChart(chart, data);
                            }
                        })
                        .catch(error => {
                            console.error('Failed to load performance data:', error);
                        });
                });
            }
            
            // åˆå§‹åŒ–æ—¥å¿—å®¹å™¨
            const logContainer = initLogContainer();
            
            // Socket.IO äº‹ä»¶ç›‘å¬å·²åœ¨ä¸Šé¢åˆå§‹åŒ–æ—¶è®¾ç½®ï¼Œè¿™é‡Œä¸éœ€è¦é‡å¤è®¾ç½®
            // ä½†æˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€äº›é¢å¤–çš„ç›‘å¬å™¨ç”¨äºè°ƒè¯•
            if (socket) {
                // å¦‚æœè¿æ¥æˆåŠŸï¼Œç­‰å¾…å›¾è¡¨åˆå§‹åŒ–åè·å–ä¸€æ¬¡åˆå§‹æ•°æ®
                socket.on('connect', function() {
                    const waitForChart = setInterval(() => {
                        if (chart) {
                            clearInterval(waitForChart);
                            // Socket.IO è¿æ¥æˆåŠŸæ—¶ï¼Œåˆå§‹æ•°æ®ä¼šé€šè¿‡ performance_update äº‹ä»¶æ¨é€
                            // ä½†ä¸ºäº†ç¡®ä¿ï¼Œæˆ‘ä»¬ä¹Ÿä¸»åŠ¨è·å–ä¸€æ¬¡
                            if (!useSocketIO) {
                                fetchPerformanceData();
                            }
                        }
                    }, 100);
                    setTimeout(() => clearInterval(waitForChart), 5000);
                });
            }
            
            // é¡µé¢åŠ è½½æ—¶è·å–åˆå§‹æ—¥å¿—
            window.onload = function() {
                fetch(`${API_BASE}/api/logs`)
                    .then(response => response.json())
                    .then(logs => {
                        if (Array.isArray(logs)) {
                            logs.forEach(log => addLogEntry(logContainer, log));
                        }
                    })
                    .catch(error => {
                        console.error('Failed to load logs:', error);
                    });
            };
        });
    </script>
</body>
</html>
